<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema CESFAM - Baja de Stock</title>
  <link rel="stylesheet" href="./css/styles.css">
</head>
<body>
  <!-- Encabezado -->
  <header>
    <div class="logo">
      <div class="logo-img">
        <img src="./image/telesalud-dark-2.27cc9379.svg" alt="Logo CESFAM">
      </div>
      <div class="logo-text">
        CESFAM <br> Farmacia
      </div>
    </div>
    <div class="header-title">
      Bajas de Stock
    </div>
  </header>

  <!-- Barra de Navegación -->
  <nav>
    <ul class="nav-buttons">
      <li><a href="index.html" class="nav-btn">Inicio</a></li>
      <li><a href="login.html" class="nav-btn">Autenticación</a></li>
      <li><a href="stock.html" class="nav-btn-selected">Gestión de Stock</a></li>
      <li><a href="prescripciones.html" class="nav-btn">Prescripciones</a></li>
      <li><a href="/prescripciones-pendientes.html" class="nav-btn">Prescripciones Pendientes</a></li>
      <li><a href="informes.html" class="nav-btn">Informes</a></li>
      <!-- Agregados botones Benjamín Cofré -->
      <li><a href="recordatorios.html" class="nav-btn">Recordatorios</a></li> 
      <li><a href="reportes.html" class="nav-btn">Reportes</a></li>
      <li><a href="ayuda.html" class="nav-btn">Ayuda</a></li>
    </ul>
  </nav>

  <!-- Contenido principal -->
  <main class="main-container">
    <section class="opcion">
      <h2>Registrar Baja</h2>
      <form id="formBaja">
        <label>Código producto:</label><br/>
        <input id="bajaCodigo" type="text" placeholder="Ej: PARA-500" required><br/>

        <label>Motivo:</label><br/>
        <select id="bajaMotivo">
          <option value="vencimiento">Fecha de vencimiento</option>
          <option value="mal_estado">Mal estado</option>
          <option value="envase_roto">Envase roto</option>
          <option value="otro">Otro</option>
        </select><br/>

        <label>Cantidad a dar de baja:</label><br/>
        <input id="bajaCantidad" type="number" min="1" value="1" required><br/>

        <label>Observaciones (opcional):</label><br/>
        <input id="bajaObs" type="text" placeholder="Observación"><br/>

        <button type="submit" class="btn-opcion">Registrar baja</button>
        <a class="btn-opcion" href="stock.html">Volver</a>
      </form>
      <div id="msgBaja"></div>
      <small>
        Nota: la baja descuenta el <b>stock disponible</b> y mueve esa cantidad a <b>pendiente de desecho</b>.
        El <b>stock físico</b> se ajusta al confirmar el desecho.
      </small>
    </section>

    <section class="opcion" style="flex-basis:100%">
      <h3>Inventario</h3>
      <div id="totales"></div>
      <div style="overflow:auto">
        <table id="tablaInventario" border="1" cellpadding="6">
          <thead>
            <tr>
              <th>Código</th>
              <th>Descripción</th>
              <th>Disponible</th>
              <th>Reservado</th>
              <th>Pend. Desecho</th>
              <th>Stock Físico</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody><!-- dinámico --></tbody>
        </table>
      </div>
    </section>
  </main>

  <!-- Pie de página -->
  <footer>
    <p>Desarrollado por <span class="developer">Equipo Caso 17 “Automatización Libreta de Medicamentos CESFAM”</span></p>
    <p>&copy; 2025 - Sistema CESFAM Farmacia - Derechos Reservados</p>
    <p>Ministerio de Salud - Chile</p>
  </footer>

  <script src="./js/stock-core.js"></script>
  <script>
    // Página Bajas: listeners de baja + confirmar desecho y render
    window.addEventListener('DOMContentLoaded', function(){
      CESFAMStock.init();
      CESFAMStock.bindBaja('formBaja', 'msgBaja');
      CESFAMStock.renderResumenTabla('totales', 'tablaInventario', true); // true = con botón "Confirmar desecho"
    });
  </script>
</body>
</html>
